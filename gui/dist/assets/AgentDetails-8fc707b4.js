import{d as _e,u as ve,r as _,c as H,o as ge,a as ye,b as f,e as o,f as t,w as a,t as i,g as R,h as ke,i as we,F as Y,j as K,k as be,l as xe,E as c,m as Ce,n as w,p as Se,q as Ie,s as Ae,v as he,x as Ee,y as Te,z as De,A as m,B as s,C as Ve,D as Le,G as je,H as Fe,I as Re,J as Ue,K as Ne,L as Pe,_ as Be}from"./index-b16e3c26.js";const Je={class:"agent-details"},$e={class:"view-header"},Me={class:"header-content"},ze={class:"agent-title"},He={key:0},Ye={class:"header-actions"},Ke={key:0,class:"loading-state"},Ge={key:1,class:"agent-content"},qe={class:"info-section"},Oe={class:"command-section"},Qe={class:"command-input-container"},We={class:"command-templates"},Xe={class:"template-grid"},Ze=["onClick"],et={class:"template-name"},tt={class:"template-description"},at={class:"tasks-section"},st={key:0,class:"loading-state"},nt={key:1,class:"empty-state"},lt={key:2,class:"tasks-list"},ot=["onClick"],it={class:"task-header"},rt={class:"task-command"},dt={class:"task-meta"},ut={key:0,class:"task-result"},ct=_e({__name:"AgentDetails",setup(mt){const G=be();xe();const d=ve(),p=G.params.id,k=_(""),h=_(!1),E=_(!1),T=_(!1),D=_(""),b=_(!1),x=_(!1),C=_({sleepInterval:30}),S=_({jitter:20}),q=_([{id:"whoami",name:"Whoami",description:"Get current user context",command:"whoami"},{id:"pwd",name:"Current Directory",description:"Show current working directory",command:"pwd"},{id:"ls",name:"List Files",description:"List files in current directory",command:"ls -la"},{id:"ps",name:"Process List",description:"Show running processes",command:"ps aux"},{id:"netstat",name:"Network Connections",description:"Show network connections",command:"netstat -an"},{id:"env",name:"Environment",description:"Show environment variables",command:"env"}]);let A=null;const n=H(()=>d.selectedAgent),U=H(()=>d.agentTasks.slice(0,10)),I=async()=>{try{E.value=!0,await d.refreshAgent(p)}catch{c.error("Failed to refresh agent")}finally{E.value=!1}},N=async()=>{if(k.value.trim())try{h.value=!0,await d.createTask(p,k.value,[],"Shell"),c.success("Command executed"),k.value="",await V()}catch{c.error("Failed to execute command")}finally{h.value=!1}},O=r=>{k.value=r.command},Q=async r=>{try{switch(r){case"screenshot":await d.createTask(p,"screenshot",[],"Screenshot"),c.success("Screenshot task created");break;case"system-info":await d.createTask(p,"systeminfo",[],"SystemInfo"),c.success("System info task created");break;case"process-list":await d.createTask(p,"tasklist",[],"ProcessList"),c.success("Process list task created");break;case"network-info":await d.createTask(p,"ipconfig",["/all"],"NetworkInfo"),c.success("Network info task created");break;case"sleep":n.value&&(C.value.sleepInterval=n.value.sleep_interval),b.value=!0;break;case"jitter":n.value&&(S.value.jitter=n.value.jitter*100),x.value=!0;break;case"exit":await Ce.confirm("Are you sure you want to terminate this agent?","Exit Agent",{confirmButtonText:"Exit",cancelButtonText:"Cancel",type:"warning"}),await d.createTask(p,"exit",[],"Exit"),c.success("Exit task created");break}}catch(e){e!=="cancel"&&c.error(`Failed to execute ${r}`)}},W=async()=>{try{await d.createTask(p,"sleep",[C.value.sleepInterval.toString()],"Sleep"),c.success("Sleep configuration updated"),b.value=!1,await I()}catch{c.error("Failed to update sleep configuration")}},X=async()=>{try{await d.createTask(p,"jitter",[(S.value.jitter/100).toString()],"Jitter"),c.success("Jitter configuration updated"),x.value=!1,await I()}catch{c.error("Failed to update jitter configuration")}},Z=r=>{D.value=D.value===r?"":r},P=r=>d.agentResults.find(e=>e.task_id===r),V=async()=>{try{T.value=!0,await d.fetchAgentTasks(p),await d.fetchAgentResults(p)}catch{}finally{T.value=!1}},B=r=>d.getAgentStatus(r),L=r=>{switch(r){case"completed":return"success";case"running":return"primary";case"pending":return"warning";case"failed":return"danger";case"timeout":return"danger";default:return"info"}},j=r=>Ve(r).format("YYYY-MM-DD HH:mm:ss"),ee=r=>d.getAgentUptime(r),te=()=>{A=setInterval(async()=>{try{await I(),await V()}catch{}},3e4)},ae=()=>{A&&(clearInterval(A),A=null)};return ge(async()=>{d.selectAgent(p),await I(),await V(),te()}),ye(()=>{ae()}),(r,e)=>{const se=w("ArrowLeft"),g=Se,v=Ie,F=Ae,ne=w("Refresh"),le=w("ArrowDown"),y=Le,oe=je,ie=he,J=w("Loading"),u=Fe,re=Ee,de=w("Position"),ue=Te,ce=w("List"),me=Re,$=Ue,M=Ne,z=De,pe=Pe;return m(),f("div",Je,[o("div",$e,[o("div",Me,[o("div",ze,[t(v,{onClick:e[0]||(e[0]=l=>r.$router.back()),text:"",type:"primary"},{default:a(()=>[t(g,null,{default:a(()=>[t(se)]),_:1})]),_:1}),n.value?(m(),f("h2",He,i(n.value.hostname),1)):R("",!0),n.value?(m(),ke(F,{key:1,type:L(n.value),size:"small"},{default:a(()=>[s(i(B(n.value)),1)]),_:1},8,["type"])):R("",!0)]),o("div",Ye,[t(v,{onClick:I,loading:E.value,type:"primary"},{default:a(()=>[t(g,null,{default:a(()=>[t(ne)]),_:1}),e[8]||(e[8]=s(" Refresh ",-1))]),_:1},8,["loading"]),t(ie,{onCommand:Q,trigger:"click"},{dropdown:a(()=>[t(oe,null,{default:a(()=>[t(y,{command:"screenshot"},{default:a(()=>[...e[10]||(e[10]=[s("Screenshot",-1)])]),_:1}),t(y,{command:"system-info"},{default:a(()=>[...e[11]||(e[11]=[s("System Info",-1)])]),_:1}),t(y,{command:"process-list"},{default:a(()=>[...e[12]||(e[12]=[s("Process List",-1)])]),_:1}),t(y,{command:"network-info"},{default:a(()=>[...e[13]||(e[13]=[s("Network Info",-1)])]),_:1}),t(y,{divided:"",command:"sleep"},{default:a(()=>[...e[14]||(e[14]=[s("Configure Sleep",-1)])]),_:1}),t(y,{command:"jitter"},{default:a(()=>[...e[15]||(e[15]=[s("Configure Jitter",-1)])]),_:1}),t(y,{divided:"",command:"exit"},{default:a(()=>[...e[16]||(e[16]=[s("Exit Agent",-1)])]),_:1})]),_:1})]),default:a(()=>[t(v,{type:"success"},{default:a(()=>[e[9]||(e[9]=s(" Actions ",-1)),t(g,null,{default:a(()=>[t(le)]),_:1})]),_:1})]),_:1})])])]),n.value?(m(),f("div",Ge,[o("div",qe,[e[18]||(e[18]=o("h3",null,"Agent Information",-1)),t(re,{column:2,border:""},{default:a(()=>[t(u,{label:"Agent ID"},{default:a(()=>[s(i(n.value.id),1)]),_:1}),t(u,{label:"Status"},{default:a(()=>[t(F,{type:L(n.value)},{default:a(()=>[s(i(B(n.value)),1)]),_:1},8,["type"])]),_:1}),t(u,{label:"Hostname"},{default:a(()=>[s(i(n.value.hostname),1)]),_:1}),t(u,{label:"Username"},{default:a(()=>[s(i(n.value.username),1)]),_:1}),t(u,{label:"Domain"},{default:a(()=>[s(i(n.value.domain),1)]),_:1}),t(u,{label:"OS"},{default:a(()=>[s(i(n.value.os),1)]),_:1}),t(u,{label:"Architecture"},{default:a(()=>[s(i(n.value.arch),1)]),_:1}),t(u,{label:"Process"},{default:a(()=>[s(i(n.value.process_name)+" ("+i(n.value.process_id)+")",1)]),_:1}),t(u,{label:"Integrity Level"},{default:a(()=>[s(i(n.value.integrity_level),1)]),_:1}),t(u,{label:"Remote IP"},{default:a(()=>[s(i(n.value.remote_ip),1)]),_:1}),t(u,{label:"Internal IP"},{default:a(()=>[s(i(n.value.internal_ip),1)]),_:1}),t(u,{label:"Sleep Interval"},{default:a(()=>[s(i(n.value.sleep_interval)+"s",1)]),_:1}),t(u,{label:"Jitter"},{default:a(()=>[s(i((n.value.jitter*100).toFixed(0))+"%",1)]),_:1}),t(u,{label:"First Seen"},{default:a(()=>[s(i(j(n.value.first_seen)),1)]),_:1}),t(u,{label:"Last Seen"},{default:a(()=>[s(i(j(n.value.last_seen)),1)]),_:1}),t(u,{label:"Uptime"},{default:a(()=>[s(i(ee(n.value)),1)]),_:1})]),_:1})]),o("div",Oe,[e[21]||(e[21]=o("h3",null,"Command Interface",-1)),o("div",Qe,[t(ue,{modelValue:k.value,"onUpdate:modelValue":e[1]||(e[1]=l=>k.value=l),placeholder:"Enter command to execute...",onKeyup:we(N,["enter"]),class:"command-input"},{append:a(()=>[t(v,{onClick:N,type:"primary",loading:h.value},{default:a(()=>[t(g,null,{default:a(()=>[t(de)]),_:1}),e[19]||(e[19]=s(" Execute ",-1))]),_:1},8,["loading"])]),_:1},8,["modelValue"])]),o("div",We,[e[20]||(e[20]=o("h4",null,"Quick Commands",-1)),o("div",Xe,[(m(!0),f(Y,null,K(q.value,l=>(m(),f("div",{key:l.id,class:"template-card",onClick:fe=>O(l)},[o("div",et,i(l.name),1),o("div",tt,i(l.description),1)],8,Ze))),128))])])]),o("div",at,[e[24]||(e[24]=o("h3",null,"Recent Tasks",-1)),T.value?(m(),f("div",st,[t(g,{class:"is-loading"},{default:a(()=>[t(J)]),_:1}),e[22]||(e[22]=o("span",null,"Loading tasks...",-1))])):U.value.length===0?(m(),f("div",nt,[t(g,null,{default:a(()=>[t(ce)]),_:1}),e[23]||(e[23]=o("span",null,"No tasks yet",-1))])):(m(),f("div",lt,[(m(!0),f(Y,null,K(U.value,l=>(m(),f("div",{key:l.id,class:"task-item",onClick:fe=>Z(l.id)},[o("div",it,[o("div",rt,i(l.command),1),t(F,{type:L(l.status),size:"small"},{default:a(()=>[s(i(l.status),1)]),_:2},1032,["type"])]),o("div",dt,[o("span",null,i(j(l.created_at)),1),o("span",null,i(l.task_type),1)]),D.value===l.id&&P(l.id)?(m(),f("div",ut,[o("pre",null,i(P(l.id).output),1)])):R("",!0)],8,ot))),128))]))])])):(m(),f("div",Ke,[t(g,{class:"is-loading"},{default:a(()=>[t(J)]),_:1}),e[17]||(e[17]=o("span",null,"Loading agent details...",-1))])),t(z,{modelValue:b.value,"onUpdate:modelValue":e[4]||(e[4]=l=>b.value=l),title:"Configure Sleep Interval",width:"400px"},{footer:a(()=>[t(v,{onClick:e[3]||(e[3]=l=>b.value=!1)},{default:a(()=>[...e[26]||(e[26]=[s("Cancel",-1)])]),_:1}),t(v,{type:"primary",onClick:W},{default:a(()=>[...e[27]||(e[27]=[s("Update",-1)])]),_:1})]),default:a(()=>[t(M,{model:C.value,"label-width":"120px"},{default:a(()=>[t($,{label:"Sleep Time"},{default:a(()=>[t(me,{modelValue:C.value.sleepInterval,"onUpdate:modelValue":e[2]||(e[2]=l=>C.value.sleepInterval=l),min:1,max:3600,style:{width:"100%"}},null,8,["modelValue"]),e[25]||(e[25]=o("div",{class:"form-help"},"Seconds between check-ins",-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(z,{modelValue:x.value,"onUpdate:modelValue":e[7]||(e[7]=l=>x.value=l),title:"Configure Jitter",width:"400px"},{footer:a(()=>[t(v,{onClick:e[6]||(e[6]=l=>x.value=!1)},{default:a(()=>[...e[29]||(e[29]=[s("Cancel",-1)])]),_:1}),t(v,{type:"primary",onClick:X},{default:a(()=>[...e[30]||(e[30]=[s("Update",-1)])]),_:1})]),default:a(()=>[t(M,{model:S.value,"label-width":"120px"},{default:a(()=>[t($,{label:"Jitter"},{default:a(()=>[t(pe,{modelValue:S.value.jitter,"onUpdate:modelValue":e[5]||(e[5]=l=>S.value.jitter=l),min:0,max:100,step:5,"show-input":"","input-size":"small"},null,8,["modelValue"]),e[28]||(e[28]=o("div",{class:"form-help"},"Percentage of sleep time to randomize",-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}});const ft=Be(ct,[["__scopeId","data-v-278b1985"]]);export{ft as default};
