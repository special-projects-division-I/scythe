<file_path>
scythe/gui/justfile
</file_path>

<edit_description>
Create justfile as alternative to Makefile for command running
</edit_description>

# SCYTHE GUI Justfile
# Command runner for SCYTHE C2 Controller GUI development
# Alternative to Makefile with simpler syntax

# =============================================================================
# CONFIGURATION
# =============================================================================

frontend_dir := "."
backend_dir := "src-tauri"
dist_dir := "dist"
build_dir := "src-tauri/target"

# Platform detection
platform := if os() == "linux" { "linux" } else if os() == "macos" { "macos" } else { "windows" }

# =============================================================================
# DEVELOPMENT TARGETS
# =============================================================================

# Default target
default: help

# Show help
help:
    @echo "SCYTHE GUI Command Runner (Justfile)"
    @echo "===================================="
    @echo ""
    @echo "Available commands:"
    @just --list

# Setup development environment
setup: check-deps install-deps
    @echo "âœ… Development environment setup complete!"

# Check dependencies
check-deps:
    @echo "ðŸ” Checking dependencies..."
    @command -v node >/dev/null 2>&1 || (echo "âŒ Node.js not found"; exit 1)
    @command -v npm >/dev/null 2>&1 || (echo "âŒ npm not found"; exit 1)
    @command -v cargo >/dev/null 2>&1 || (echo "âŒ Cargo not found"; exit 1)
    @node --version | grep -q "v18\|v19\|v20" || (echo "âŒ Node.js 18+ required"; exit 1)
    @echo "âœ… All dependencies available"

# Install dependencies
install-deps: install-frontend-deps install-backend-deps

install-frontend-deps:
    @echo "ðŸ“¦ Installing frontend dependencies..."
    npm install
    @echo "âœ… Frontend dependencies installed"

install-backend-deps:
    @echo "ðŸ“¦ Backend dependencies handled by Cargo"

# Start development server
dev: check-deps install-frontend-deps
    @echo "ðŸš€ Starting development server..."
    npm run tauri dev

# Start frontend only
dev-frontend:
    @echo "ðŸŽ¨ Starting frontend development server..."
    npm run dev

# Start backend only
dev-backend:
    @echo "âš™ï¸ Starting backend development server..."
    cd {{backend_dir}} && cargo tauri dev

# Build for development
build-dev: check-deps
    @echo "ðŸ”¨ Building for development..."
    npm run tauri build -- --debug
    @echo "âœ… Development build complete"

# =============================================================================
# PRODUCTION BUILD TARGETS
# =============================================================================

# Build for production
build: check-deps build-frontend build-backend
    @echo "âœ… Production build complete!"

# Build frontend
build-frontend: install-frontend-deps
    @echo "ðŸŽ¨ Building frontend..."
    npm run build
    @echo "âœ… Frontend built"

# Build backend
build-backend:
    @echo "âš™ï¸ Building backend..."
    cd {{backend_dir}} && cargo tauri build --release
    @echo "âœ… Backend built"

# Build release version
build-release: check-deps
    @echo "ðŸ† Building release version..."
    cd {{backend_dir}} && cargo tauri build --release
    @echo "âœ… Release build complete"

# =============================================================================
# CROSS-PLATFORM BUILDS
# =============================================================================

# Build for Linux
build-linux: check-deps
    @echo "ðŸ§ Building for Linux..."
    cd {{backend_dir}} && cargo tauri build --target x86_64-unknown-linux-gnu --release
    @echo "âœ… Linux build complete"

# Build for Linux ARM64
build-linux-arm64: check-deps
    @echo "ðŸ§ Building for Linux ARM64..."
    cd {{backend_dir}} && cargo tauri build --target aarch64-unknown-linux-gnu --release
    @echo "âœ… Linux ARM64 build complete"

# Build for Windows
build-windows: check-deps
    @echo "ðŸªŸ Building for Windows..."
    cd {{backend_dir}} && cargo tauri build --target x86_64-pc-windows-msvc --release
    @echo "âœ… Windows build complete"

# Build for macOS
build-macos: check-deps
    @echo "ðŸŽ Building for macOS..."
    cd {{backend_dir}} && cargo tauri build --target x86_64-apple-darwin --release
    @echo "âœ… macOS build complete"

# Build for macOS ARM64
build-macos-arm64: check-deps
    @echo "ðŸŽ Building for macOS ARM64..."
    cd {{backend_dir}} && cargo tauri build --target aarch64-apple-darwin --release
    @echo "âœ… macOS ARM64 build complete"

# Build for all platforms
build-all: build-linux build-windows build-macos
    @echo "âœ… All platforms built!"

# =============================================================================
# TESTING & QUALITY ASSURANCE
# =============================================================================

# Run all tests
test: test-frontend test-backend

# Test frontend
test-frontend:
    @echo "ðŸ§ª Testing frontend..."
    npm test || echo "âš ï¸ No frontend tests found"

# Test backend
test-backend:
    @echo "ðŸ§ª Testing backend..."
    cd {{backend_dir}} && cargo test || echo "âš ï¸ No backend tests found"

# Run linting
lint: lint-frontend lint-backend

# Lint frontend
lint-frontend:
    @echo "ðŸ” Linting frontend..."
    npx eslint src/ --ext .ts,.vue || echo "âš ï¸ ESLint not configured"

# Lint backend
lint-backend:
    @echo "ðŸ” Linting backend..."
    cd {{backend_dir}} && cargo clippy || echo "âš ï¸ Clippy not available"

# Type checking
type-check:
    @echo "ðŸ” Running TypeScript type check..."
    npx tsc --noEmit
    @echo "âœ… TypeScript check passed"

# Run all checks
check: type-check lint test
    @echo "âœ… All checks passed!"

# =============================================================================
# CLEANUP TARGETS
# =============================================================================

# Clean all artifacts
clean: clean-frontend clean-backend clean-dist

# Clean frontend
clean-frontend:
    @echo "ðŸ§¹ Cleaning frontend..."
    rm -rf node_modules package-lock.json {{dist_dir}}
    @echo "âœ… Frontend cleaned"

# Clean backend
clean-backend:
    @echo "ðŸ§¹ Cleaning backend..."
    cd {{backend_dir}} && cargo clean
    @echo "âœ… Backend cleaned"

# Clean distribution
clean-dist:
    @echo "ðŸ§¹ Cleaning distribution..."
    rm -rf {{dist_dir}} {{build_dir}}
    @echo "âœ… Distribution cleaned"

# Clean everything
clean-all: clean
    @echo "ðŸ§¹ Cleaning caches..."
    npm cache clean --force 2>/dev/null || true
    cd {{backend_dir}} && cargo cache --autoclean 2>/dev/null || true
    @echo "âœ… All cleaned"

# =============================================================================
# UTILITY TARGETS
# =============================================================================

# Update dependencies
update-deps: update-frontend-deps update-backend-deps

# Update frontend deps
update-frontend-deps:
    @echo "â¬†ï¸ Updating frontend dependencies..."
    npm update
    @echo "âœ… Frontend dependencies updated"

# Update backend deps
update-backend-deps:
    @echo "â¬†ï¸ Updating backend dependencies..."
    cd {{backend_dir}} && cargo update
    @echo "âœ… Backend dependencies updated"

# Format code
format: format-frontend format-backend

# Format frontend
format-frontend:
    @echo "ðŸŽ¨ Formatting frontend..."
    npx prettier --write src/
    @echo "âœ… Frontend formatted"

# Format backend
format-backend:
    @echo "ðŸŽ¨ Formatting backend..."
    cd {{backend_dir}} && cargo fmt
    @echo "âœ… Backend formatted"

# Generate documentation
docs: docs-frontend docs-backend

# Frontend docs
docs-frontend:
    @echo "ðŸ“š Generating frontend docs..."
    npx typedoc src/ || echo "âš ï¸ TypeDoc not configured"

# Backend docs
docs-backend:
    @echo "ðŸ“š Generating backend docs..."
    cd {{backend_dir}} && cargo doc --open --no-deps || echo "âš ï¸ Cargo doc failed"

# Show project info
info:
    @echo "SCYTHE GUI Information"
    @echo "======================"
    @echo "Platform: {{platform}}"
    @echo "Node.js: $(node --version)"
    @echo "npm: $(npm --version)"
    @echo "Rust: $(rustc --version)"
    @echo "Cargo: $(cargo --version)"
    @echo ""
    @echo "Project Structure:"
    @echo "  Frontend: {{frontend_dir}}"
    @echo "  Backend: {{backend_dir}}"
    @echo "  Dist: {{dist_dir}}"
    @echo "  Build: {{build_dir}}"

# Show version
version:
    @echo "SCYTHE GUI v0.1.0"
    @echo "Node.js: $(node --version)"
    @echo "Rust: $(rustc --version)"
    @echo "Platform: {{platform}}"

# Run diagnostics
doctor: check-deps
    @echo "ðŸ” Running diagnostics..."
    npm doctor || echo "âš ï¸ npm doctor failed"
    cd {{backend_dir}} && cargo doctor || echo "âš ï¸ cargo doctor failed"
    @echo "âœ… Diagnostics complete"

# =============================================================================
# DEVELOPMENT WORKFLOW
# =============================================================================

# Watch for changes
watch: check-deps
    @echo "ðŸ‘€ Watching for changes..."
    npm run tauri dev -- --watch

# Serve production build
serve: build
    @echo "ðŸŒ Serving production build..."
    cd {{dist_dir}} && python3 -m http.server 8080 || npx serve -p 8080

# Prepare deployment
deploy: build-release
    @echo "ðŸ“¦ Preparing deployment..."
    mkdir -p deploy
    cp -r {{build_dir}}/release/bundle/* deploy/ 2>/dev/null || true
    cp -r {{dist_dir}} deploy/ 2>/dev/null || true
    @echo "âœ… Deployment package ready in ./deploy/"

# Quick development cycle
quick-dev: clean-frontend install-frontend-deps dev

# Full CI/CD pipeline
ci: check-deps clean install-deps check build test
    @echo "âœ… CI/CD pipeline completed successfully!"
